{
  "paths": {
    "/api/expressions": {
      "get": {
        "summary": "Get all expressions",
        "description": "Retrieve a paginated list of expressions with optional filtering",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number for pagination",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Number of items per page",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search in expression, definition, or Spanish translations",
            "schema": {
              "type": "string",
              "example": "break the ice"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by expression type (can be multiple, comma-separated)",
            "schema": {
              "type": "string",
              "example": "idiom,phrase"
            }
          },
          {
            "name": "difficulty",
            "in": "query",
            "description": "Filter by difficulty level",
            "schema": {
              "type": "string",
              "enum": ["A1", "A2", "B1", "B2", "C1", "C2"],
              "example": "B2"
            }
          },
          {
            "name": "language",
            "in": "query",
            "description": "Filter by language",
            "schema": {
              "type": "string",
              "example": "en"
            }
          },
          {
            "name": "hasImage",
            "in": "query",
            "description": "Filter by expressions that have an image",
            "schema": {
              "type": "string",
              "enum": ["true", "false"],
              "example": "true"
            }
          },
          {
            "name": "hasContext",
            "in": "query",
            "description": "Filter by expressions that have context",
            "schema": {
              "type": "string",
              "enum": ["true", "false"],
              "example": "true"
            }
          },
          {
            "name": "createdAt",
            "in": "query",
            "description": "Filter by creation date (ISO 8601)",
            "schema": {
              "type": "string",
              "format": "date-time",
              "example": "2024-01-01T00:00:00Z"
            }
          },
          {
            "name": "updatedAt",
            "in": "query",
            "description": "Filter by update date (ISO 8601)",
            "schema": {
              "type": "string",
              "format": "date-time",
              "example": "2024-01-01T00:00:00Z"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expressions retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expressions retrieved successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "expressions": {
                          "type": "array",
                          "items": {
                            "$ref": "../schemas/common.json#/components/schemas/Expression"
                          }
                        },
                        "pagination": {
                          "$ref": "../schemas/common.json#/components/schemas/PaginationResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error retrieving expressions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "post": {
        "summary": "Create a new expression",
        "description": "Create a new expression with all its properties",
        "tags": ["Expressions"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "../schemas/common.json#/components/schemas/Expression"
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Expression created successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expression created successfully"
                    },
                    "data": {
                      "$ref": "../schemas/common.json#/components/schemas/Expression"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/{id}": {
      "get": {
        "summary": "Get expression by ID",
        "description": "Retrieve a specific expression by its unique identifier",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Unique identifier of the expression",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expression retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expression retrieved successfully"
                    },
                    "data": {
                      "$ref": "../schemas/common.json#/components/schemas/Expression"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error retrieving expression",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "put": {
        "summary": "Update expression",
        "description": "Update an existing expression with new data",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Unique identifier of the expression to update",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "../schemas/common.json#/components/schemas/Expression"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Expression updated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expression updated successfully"
                    },
                    "data": {
                      "$ref": "../schemas/common.json#/components/schemas/Expression"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Delete expression",
        "description": "Delete an expression permanently",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "Unique identifier of the expression to delete",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expression deleted successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expression deleted successfully"
                    },
                    "data": {
                      "type": "object",
                      "example": {}
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error deleting expression",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/export-file": {
      "get": {
        "summary": "Export expressions to JSON",
        "description": "Export all expressions to a downloadable JSON file",
        "tags": ["Expressions"],
        "responses": {
          "200": {
            "description": "Expressions exported successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Exported 150 expressions successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "totalExpressions": {
                          "type": "integer",
                          "description": "Total number of expressions exported"
                        },
                        "exportDate": {
                          "type": "string",
                          "format": "date-time",
                          "description": "Export timestamp"
                        },
                        "expressions": {
                          "type": "array",
                          "items": {
                            "$ref": "../schemas/common.json#/components/schemas/Expression"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error exporting expressions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/import-file": {
      "post": {
        "summary": "Import expressions from JSON file",
        "description": "Import expressions from an uploaded JSON file with advanced options",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "duplicateStrategy",
            "in": "query",
            "description": "Strategy for handling duplicate expressions",
            "schema": {
              "type": "string",
              "enum": ["skip", "overwrite", "error", "merge"],
              "default": "skip",
              "example": "skip"
            }
          },
          {
            "name": "validateOnly",
            "in": "query",
            "description": "Only validate without importing",
            "schema": {
              "type": "string",
              "enum": ["true", "false"],
              "default": "false",
              "example": "false"
            }
          },
          {
            "name": "batchSize",
            "in": "query",
            "description": "Number of expressions to process per batch",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10,
              "example": 10
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "multipart/form-data": {
              "schema": {
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary",
                    "description": "JSON file containing expressions data"
                  }
                },
                "required": ["file"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Import completed successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Import completed successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "imported": {
                          "type": "integer",
                          "description": "Number of expressions imported"
                        },
                        "skipped": {
                          "type": "integer",
                          "description": "Number of expressions skipped"
                        },
                        "errors": {
                          "type": "integer",
                          "description": "Number of import errors"
                        },
                        "validationResults": {
                          "type": "array",
                          "description": "Validation results when validateOnly=true"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "No file uploaded, Invalid JSON file format, or Invalid parameters",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error importing expressions",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/generate": {
      "post": {
        "summary": "Generate expression with AI",
        "description": "Generate a new expression with definition, examples, and metadata using AI.",
        "tags": ["Expressions"],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "prompt": { "type": "string", "description": "Prompt for generating the expression." },
                  "language": { "type": "string", "description": "Language code.", "default": "en" },
                  "options": { "type": "object", "description": "Additional AI options (e.g., provider)." }
                },
                "required": ["prompt"]
              },
              "example": {
                "prompt": "Generate an idiom about friendship",
                "language": "en",
                "options": { "provider": "openai" }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Expression generated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "../schemas/common.json#/components/schemas/Expression" }
              }
            }
          },
          "400": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" },
          "500": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/expressions/{id}/generate-image": {
      "post": {
        "summary": "Generate expression image with AI",
        "description": "Generate an image for an expression using AI and update the expression record.",
        "tags": ["Expressions"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "expressionString": { "type": "string", "description": "Expression text to generate image for." },
                  "imgOld": { "type": "string", "description": "URL of old image to replace (optional)." }
                },
                "required": ["expressionString"]
              },
              "example": {
                "expressionString": "break the ice",
                "imgOld": "https://res.cloudinary.com/..."
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Expression image updated successfully",
            "content": {
              "application/json": {
                "schema": { "$ref": "../schemas/common.json#/components/schemas/Expression" }
              }
            }
          },
          "400": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" },
          "500": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" }
        }
      }
    },
    "/api/expressions/by-type/{type}": {
      "get": {
        "summary": "Get expressions by type",
        "description": "Retrieve expressions filtered by specific type",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "type",
            "in": "path",
            "required": true,
            "description": "Expression type to filter by",
            "schema": {
              "type": "string",
              "example": "idiom"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Number of expressions to retrieve",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 10,
              "example": 10
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search term for filtering",
            "schema": {
              "type": "string",
              "example": "break"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expressions by type retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expressions of type idiom retrieved successfully"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "../schemas/common.json#/components/schemas/Expression"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error getting expressions by type",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/expressions-only": {
      "get": {
        "summary": "Get expressions only (simplified)",
        "description": "Retrieve expressions with simplified response format for performance",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "page",
            "in": "query",
            "description": "Page number for pagination",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "default": 1
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "Number of items per page",
            "schema": {
              "type": "integer",
              "minimum": 1,
              "maximum": 100,
              "default": 10
            }
          },
          {
            "name": "search",
            "in": "query",
            "description": "Search in expression, definition, or Spanish translations",
            "schema": {
              "type": "string",
              "example": "break the ice"
            }
          },
          {
            "name": "type",
            "in": "query",
            "description": "Filter by expression type",
            "schema": {
              "type": "string",
              "example": "idiom"
            }
          },
          {
            "name": "difficulty",
            "in": "query",
            "description": "Filter by difficulty level",
            "schema": {
              "type": "string",
              "enum": ["A1", "A2", "B1", "B2", "C1", "C2"],
              "example": "B2"
            }
          },
          {
            "name": "language",
            "in": "query",
            "description": "Filter by language",
            "schema": {
              "type": "string",
              "example": "en"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expressions retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expressions retrieved successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "expressions": {
                          "type": "array",
                          "items": {
                            "$ref": "../schemas/common.json#/components/schemas/Expression"
                          }
                        },
                        "pagination": {
                          "$ref": "../schemas/common.json#/components/schemas/PaginationResponse"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error getting expressions only",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/{expression}/expression": {
      "get": {
        "summary": "Find expression by expression text",
        "description": "Retrieve a specific expression by searching for its exact text",
        "tags": ["Expressions"],
        "parameters": [
          {
            "name": "expression",
            "in": "path",
            "required": true,
            "description": "Expression text to search for",
            "schema": {
              "type": "string",
              "example": "break the ice"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Expression retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Expression retrieved successfully"
                    },
                    "data": {
                      "$ref": "../schemas/common.json#/components/schemas/Expression"
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error finding expression by expression text",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/{id}/chat": {
      "post": {
        "summary": "Add chat message to expression",
        "description": "Add a user message to the expression chat history",
        "tags": ["Expressions", "Chat"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID of the expression to add chat message to",
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "message": {
                    "type": "string",
                    "description": "User message to add to chat",
                    "example": "Can you explain this expression better?"
                  }
                },
                "required": ["message"]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Chat message added successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Chat message added successfully"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "expression": {
                          "$ref": "../schemas/common.json#/components/schemas/Expression"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Message is required",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error adding chat message",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "Get chat history for expression",
        "description": "Retrieve the complete chat history for an expression",
        "tags": ["Expressions", "Chat"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID of the expression to get chat history for",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Chat history retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Chat history retrieved successfully"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "$ref": "../schemas/common.json#/components/schemas/ChatMessage"
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error getting chat history",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      },
      "delete": {
        "summary": "Clear chat history for expression",
        "description": "Delete all chat messages for an expression",
        "tags": ["Expressions", "Chat"],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "description": "ID of the expression to clear chat history for",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Chat history cleared successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean",
                      "example": true
                    },
                    "message": {
                      "type": "string",
                      "example": "Chat history cleared successfully"
                    },
                    "data": {
                      "type": "object",
                      "example": {}
                    }
                  }
                }
              }
            }
          },
          "404": {
            "description": "Expression not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          },
          "500": {
            "description": "Error clearing chat history",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "../schemas/common.json#/components/schemas/ErrorResponse"
                }
              }
            }
          }
        }
      }
    },
    "/api/expressions/{id}/chat/stream": {
      "post": {
        "summary": "Stream chat response for expression",
        "description": "Send a message and receive a streaming AI response for expression chat.",
        "tags": ["Expressions", "Chat"],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "schema": { "type": "string" } }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "message": { "type": "string", "description": "User message to send." }
                },
                "required": ["message"]
              },
              "example": { "message": "Can you give me more examples of this expression?" }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Streaming response started",
            "content": {
              "text/plain": {
                "schema": { "type": "string", "description": "Streaming text response from AI." }
              }
            },
            "headers": {
              "Content-Type": { "schema": { "type": "string", "example": "text/plain; charset=utf-8" } },
              "Cache-Control": { "schema": { "type": "string", "example": "no-cache" } },
              "Connection": { "schema": { "type": "string", "example": "keep-alive" } }
            }
          },
          "400": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" },
          "404": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" },
          "500": { "$ref": "../schemas/common.json#/components/schemas/ErrorResponse" }
        }
      }
    }
  }
}