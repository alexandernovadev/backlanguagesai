openapi: 3.0.0
info:
  title: Expression API
  version: 2.0.0
  description: API for managing idiomatic expressions, AI generation, and interactive chat features
paths:
  # ===== AI GENERATION ROUTES =====
  /api/expressions/generate:
    post:
      summary: Generate expression with AI
      tags:
        - Expressions
      description: Generate idiomatic expressions using AI with customizable options
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                prompt:
                  type: string
                  description: The prompt for AI to generate the expression
                options:
                  type: object
                  properties:
                    language:
                      type: string
                      enum: [en, es, pt]
                      default: en
                      description: Target language for the expression
                    difficulty:
                      type: string
                      enum: [easy, medium, hard]
                      default: medium
                      description: Difficulty level of the expression
                    type:
                      type: array
                      items:
                        type: string
                        enum: [idiom, phrase, collocation, slang, formal, informal]
                      description: Types of expressions to generate
                    context:
                      type: string
                      description: Context or situation for the expression
              required:
                - prompt
      responses:
        '200':
          description: Expression generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression generated successfully"
                  data:
                    type: object
                    description: Generated expression object
        '400':
          description: Prompt is required
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Prompt is required"
        '500':
          description: Error generating expression

  /api/expressions/{idexpression}/generate-image:
    post:
      summary: Generate expression image with AI
      tags:
        - Expressions
      parameters:
        - in: path
          name: idexpression
          required: true
          schema:
            type: string
          description: Expression ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expressionString:
                  type: string
                  description: Expression description for image generation
                imgOld:
                  type: string
                  description: URL of old image to replace
              required:
                - expressionString
      responses:
        '200':
          description: Expression image updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression image updated successfully"
                  data:
                    type: object
                    description: Updated expression object
        '400':
          description: Expression prompt is required
        '404':
          description: Expression not found
        '500':
          description: Error generating expression image

  # ===== CHAT ROUTES =====
  /api/expressions/{expressionId}/chat:
    post:
      summary: Add chat message to expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: expressionId
          required: true
          schema:
            type: string
          description: Expression ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: User message to add to chat
              required:
                - message
      responses:
        '200':
          description: Chat message added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Chat message added successfully"
                  data:
                    type: object
                    properties:
                      expression:
                        type: object
                        description: Expression object with updated chat
        '400':
          description: Message is required
        '404':
          description: Expression not found
        '500':
          description: Error adding chat message

    get:
      summary: Get chat history for expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: expressionId
          required: true
          schema:
            type: string
          description: Expression ID
      responses:
        '200':
          description: Chat history retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Chat history retrieved successfully"
                  data:
                    type: array
                    items:
                      type: object
                      description: Chat message object
        '404':
          description: Expression not found
        '500':
          description: Error retrieving chat history

    delete:
      summary: Clear chat history for expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: expressionId
          required: true
          schema:
            type: string
          description: Expression ID
      responses:
        '200':
          description: Chat history cleared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Chat history cleared successfully"
                  data:
                    type: object
        '404':
          description: Expression not found
        '500':
          description: Error clearing chat history

  /api/expressions/{expressionId}/chat/stream:
    post:
      summary: Stream chat response for expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: expressionId
          required: true
          schema:
            type: string
          description: Expression ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                message:
                  type: string
                  description: User message for AI response
              required:
                - message
      responses:
        '200':
          description: Chat response streamed successfully
          content:
            text/plain:
              schema:
                type: string
                example: "This is a streaming response from the AI assistant..."
        '400':
          description: Message is required
        '404':
          description: Expression not found
        '500':
          description: Error streaming chat response

  # ===== FILTER AND SEARCH ROUTES =====
  /api/expressions/by-type/{type}:
    get:
      summary: Get expressions by type
      tags:
        - Expressions
      parameters:
        - in: path
          name: type
          required: true
          schema:
            type: string
            enum: [idiom, phrase, collocation, slang, formal, informal]
          description: Type of expression to filter by
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            minimum: 1
          description: Number of expressions per page
        - in: query
          name: language
          schema:
            type: string
            enum: [en, es, pt]
          description: Filter by language
        - in: query
          name: difficulty
          schema:
            type: string
            enum: [easy, medium, hard]
          description: Filter by difficulty level
      responses:
        '200':
          description: Expressions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expressions retrieved successfully"
                  data:
                    type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          description: Expression object
                      total:
                        type: integer
                        example: 25
                      page:
                        type: integer
                        example: 1
                      pages:
                        type: integer
                        example: 3
        '500':
          description: Internal server error

  /api/expressions/expressions-only:
    get:
      summary: Get expressions only (lightweight)
      tags:
        - Expressions
      description: Get expressions with minimal data for performance
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            minimum: 1
          description: Number of expressions per page
        - in: query
          name: language
          schema:
            type: string
            enum: [en, es, pt]
          description: Filter by language
        - in: query
          name: difficulty
          schema:
            type: string
            enum: [easy, medium, hard]
          description: Filter by difficulty level
        - in: query
          name: type
          schema:
            type: string
            enum: [idiom, phrase, collocation, slang, formal, informal]
          description: Filter by expression type
      responses:
        '200':
          description: Expressions retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expressions retrieved successfully"
                  data:
                    type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          description: Lightweight expression object
                      total:
                        type: integer
                        example: 50
                      page:
                        type: integer
                        example: 1
                      pages:
                        type: integer
                        example: 5
        '500':
          description: Internal server error

  /api/expressions/{expression}/expression:
    get:
      summary: Find expression by expression text
      tags:
        - Expressions
      parameters:
        - in: path
          name: expression
          required: true
          schema:
            type: string
          description: The expression text to search for
      responses:
        '200':
          description: Expression found successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression retrieved successfully"
                  data:
                    type: object
                    description: Expression object
        '404':
          description: Expression not found
        '500':
          description: Internal server error

  # ===== CRUD ROUTES =====
  /api/expressions:
    get:
      summary: Get all expressions with filters
      tags:
        - Expressions
      description: Retrieve expressions with comprehensive filtering options
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
            minimum: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
            minimum: 1
          description: Number of expressions per page
        - in: query
          name: search
          schema:
            type: string
          description: Search term for expression, definition, or context
        - in: query
          name: language
          schema:
            type: string
            enum: [en, es, pt]
          description: Filter by language
        - in: query
          name: difficulty
          schema:
            type: string
            enum: [easy, medium, hard]
          description: Filter by difficulty level
        - in: query
          name: type
          schema:
            type: string
            enum: [idiom, phrase, collocation, slang, formal, informal]
          description: Filter by expression type
        - in: query
          name: hasImage
          schema:
            type: boolean
          description: Filter expressions that have images
        - in: query
          name: hasSpanish
          schema:
            type: boolean
          description: Filter expressions that have Spanish translation
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, updatedAt, expression, difficulty, language]
            default: createdAt
          description: Field to sort by
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
      responses:
        '200':
          description: Successfully retrieved expressions
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expressions retrieved successfully"
                  data:
                    type: object
                    properties:
                      data:
                        type: array
                        items:
                          type: object
                          description: Expression object
                      total:
                        type: integer
                        example: 100
                      page:
                        type: integer
                        example: 1
                      pages:
                        type: integer
                        example: 10
        '500':
          description: Internal server error

    post:
      summary: Create a new expression
      tags:
        - Expressions
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expression:
                  type: string
                  description: The expression text
                definition:
                  type: string
                  description: Definition of the expression
                context:
                  type: string
                  description: Context or usage example
                language:
                  type: string
                  enum: [en, es, pt]
                  description: Language of the expression
                difficulty:
                  type: string
                  enum: [easy, medium, hard]
                  description: Difficulty level
                type:
                  type: array
                  items:
                    type: string
                    enum: [idiom, phrase, collocation, slang, formal, informal]
                  description: Types of expression
                spanish:
                  type: object
                  properties:
                    expression:
                      type: string
                    definition:
                      type: string
                  description: Spanish translation
              required:
                - expression
                - definition
                - language
      responses:
        '201':
          description: Expression created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression created successfully"
                  data:
                    type: object
                    description: Created expression object
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Expression already exists"
        '500':
          description: Internal server error

  /api/expressions/{id}:
    get:
      summary: Get expression by ID
      tags:
        - Expressions
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Expression ID
      responses:
        '200':
          description: Expression retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression retrieved successfully"
                  data:
                    type: object
                    description: Expression object
        '404':
          description: Expression not found
        '500':
          description: Internal server error

    put:
      summary: Update expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Expression ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                expression:
                  type: string
                  description: The expression text
                definition:
                  type: string
                  description: Definition of the expression
                context:
                  type: string
                  description: Context or usage example
                language:
                  type: string
                  enum: [en, es, pt]
                  description: Language of the expression
                difficulty:
                  type: string
                  enum: [easy, medium, hard]
                  description: Difficulty level
                type:
                  type: array
                  items:
                    type: string
                    enum: [idiom, phrase, collocation, slang, formal, informal]
                  description: Types of expression
                spanish:
                  type: object
                  properties:
                    expression:
                      type: string
                    definition:
                      type: string
                  description: Spanish translation
      responses:
        '200':
          description: Expression updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression updated successfully"
                  data:
                    type: object
                    description: Updated expression object
        '404':
          description: Expression not found
        '500':
          description: Internal server error

    delete:
      summary: Delete expression
      tags:
        - Expressions
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Expression ID
      responses:
        '200':
          description: Expression deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Expression deleted successfully"
                  data:
                    type: object
        '404':
          description: Expression not found
        '500':
          description: Internal server error

  # ===== IMPORT/EXPORT ROUTES =====
  /api/expressions/export-file:
    get:
      summary: Export expressions to JSON file
      tags:
        - Expressions
      description: Downloads a JSON file containing all expressions in the database
      security:
        - BearerAuth: []
      responses:
        '200':
          description: JSON file with all expressions
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Exported 100 expressions successfully"
                  data:
                    type: object
                    properties:
                      totalExpressions:
                        type: number
                        example: 100
                      exportDate:
                        type: string
                        format: date-time
                        example: "2025-01-15T10:30:00.000Z"
                      expressions:
                        type: array
                        items:
                          type: object
                          description: Expression object
        '401':
          description: Unauthorized - Token not provided
        '403':
          description: Forbidden - Invalid token
        '500':
          description: Internal server error

  /api/expressions/import-file:
    post:
      summary: Import expressions from JSON file
      tags:
        - Expressions
      description: Import expressions from a JSON file with various duplicate handling strategies
      parameters:
        - in: query
          name: duplicateStrategy
          schema:
            type: string
            enum: [skip, overwrite, error, merge]
            default: skip
          description: Strategy to handle duplicate expressions
        - in: query
          name: validateOnly
          schema:
            type: boolean
            default: false
          description: If true, only validates the file without importing
        - in: query
          name: batchSize
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of expressions to process in each batch
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: JSON file containing expressions to import
      responses:
        '200':
          description: Import completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Import completed successfully"
                  data:
                    type: object
                    description: Import result object
        '400':
          description: Bad request - Invalid file format or parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Invalid JSON file format"
        '500':
          description: Internal server error during import

tags:
  - name: Expressions
    description: Idiomatic expressions management, AI generation, and interactive chat features